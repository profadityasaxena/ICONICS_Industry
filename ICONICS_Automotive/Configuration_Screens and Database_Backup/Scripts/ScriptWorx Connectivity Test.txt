' *****************************************************************************
'  Script Connectivity_Test generated by ScriptWizard
'
'  Description:
'    Reads an OPC Tag value.
'
' *****************************************************************************
Public Sub Connectivity_Test(td As TriggerData)
On Error GoTo ErrHandler

    ' [Creating Variable to Read Test Tag]
    Dim opcval As Variant
    opcval = g.OPC.Read("Kepware.KEPServerEX.V6\SB1_PLC.RJ71EN71.01_Sub Group1.Engine WIP.Engine Number.SG1_ST00_Engine No")
    
    Dim database_connection     As Object
    Dim result_set              As Object
    Dim query_string            As String
    
    ' [Building the Database Credentials]
    Set database_connection = CreateObject("ADODB.Connection")
    database_connection.ConnectionString = "Provider=SQLOLEDB;Data Source=AK-WKS-0476-LS\SQLEXPRESS2017;Initial Catalog=BajajMEA; User ID=sa; Password=sql_1234; MultipleActiveResultSets=True"
    
    ' [Opening the Database Connection]
    database_connection.Open
        
        ' [Declaring a Result Set]
        Set result_set = CreateObject("ADODB.RecordSet")
        
        ' [Declaring the Query String]
        query_string = "INSERT INTO [dbo].[scriptworx_connectivity_test_table]([opcval])VALUES('success')"
            
        ' [Executing the Query String]
        database_connection.Execute query_string
    
        ' [Closing the Result Set]
        result_set.Close
        Set result_set = Nothing
    
    ' [Closing the Datavase Connection]
    database_connection.Close
    Set database_connection = Nothing
    
    ' Uncomment the next line to display the value 'opcval' in the MonitorWorX console in the tab Runtime.
     g.ConsoleMsg MSG_INFO_VERBOSE, "Kepware.KEPServerEX.V6\SB1_PLC.RJ71EN71.01_Sub Group1.Engine WIP.Engine Number.SG1_ST00_Engine No", opcval
    Exit Sub

ErrHandler:
    g.ConsoleMsg MSG_SEVERE_ERROR, "Kepware.KEPServerEX.V6\SB1_PLC.RJ71EN71.01_Sub Group1.Engine WIP.Engine Number.SG1_ST00_Engine No", "Error reading the OPC value: " & Err.Description
End Sub

